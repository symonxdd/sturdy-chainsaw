name: Wails Windows Build

on:
  push:
    tags:
      - "v*" # Trigger on version tags like v1.0.0

env:
  NODE_OPTIONS: "--max-old-space-size=4096" # Prevent OOM issues during build

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          submodules: recursive

      - name: Build Wails App for Windows
        uses: dAppServer/wails-build-action@v2.2
        id: build
        with:
          build-name: "AVD Launcher"
          build-platform: "windows/amd64"
          package: false
          go-version: "1.24.2" # Your actual Go version

      - name: Upload .exe to GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: build/bin/*.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
